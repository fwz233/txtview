
<html>

    <body>
        <!-- <div id="title1">页数和百分比</div> -->
        <div id="title2">233</div>
        <!-- <div id="title3">数组内容</div> -->
        <textarea cols="40" rows="20" id="txt1" ></textarea>
    </body>
    <head>
        <title>ab</title>
        <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
        <script type="text/javascript">

$("#title1").on("click", function(){  //  单事件绑定

   //console.log(String(str2ab($("#txt1").val())))
  //alert(toUint8Arr($("#txt1").val()))
   //document.execCommand(toUint8Arr($("#txt1").val()))
	// 要保存的字符串
    const stringData =String(str2ab($("#txt1").val()))
					// dada 表示要转换的字符串数据，type 表示要转换的数据格式
					const blob = new Blob([stringData], {
						type: "text/plain;charset=utf-8"
					})
					// 根据 blob生成 url链接
					const objectURL = URL.createObjectURL(blob)

					// 创建一个 a 标签Tag
					const aTag = document.createElement('a')
					// 设置文件的下载地址
					aTag.href = objectURL
					// 设置保存后的文件名称
					aTag.download = "页数和百分比.txt"
					// 给 a 标签添加点击事件
					aTag.click()
					// 释放一个之前已经存在的、通过调用 URL.createObjectURL() 创建的 URL 对象。
					// 当你结束使用某个 URL 对象之后，应该通过调用这个方法来让浏览器知道不用在内存中继续保留对这个文件的引用了。
					URL.revokeObjectURL(objectURL)

}); 

$("#title2").on("click", function(){  //  单事件绑定

//console.log(String(str2ab($("#txt1").val())))
//alert(toUint8Arr($("#txt1").val()))
//document.execCommand(toUint8Arr($("#txt1").val()))
 // 要保存的字符串
 const stringData =String(str2ab2($("#txt1").val()))
                 // dada 表示要转换的字符串数据，type 表示要转换的数据格式
                 const blob = new Blob([stringData], {
                     type: "text/plain;charset=utf-8"
                 })
                 // 根据 blob生成 url链接
                 const objectURL = URL.createObjectURL(blob)

                 // 创建一个 a 标签Tag
                 const aTag = document.createElement('a')
                 // 设置文件的下载地址
                 aTag.href = objectURL
                 // 设置保存后的文件名称
                 aTag.download = "233.txt"
                 // 给 a 标签添加点击事件
                 aTag.click()
                 // 释放一个之前已经存在的、通过调用 URL.createObjectURL() 创建的 URL 对象。
                 // 当你结束使用某个 URL 对象之后，应该通过调用这个方法来让浏览器知道不用在内存中继续保留对这个文件的引用了。
                 URL.revokeObjectURL(objectURL)

}); 

$("#title3").on("click", function(){  //  单事件绑定

//console.log(String(str2ab($("#txt1").val())))
//alert(toUint8Arr($("#txt1").val()))
//document.execCommand(toUint8Arr($("#txt1").val()))
 // 要保存的字符串
 const stringData =String(str2ab3($("#txt1").val()))
                 // dada 表示要转换的字符串数据，type 表示要转换的数据格式
                 const blob = new Blob([stringData], {
                     type: "text/plain;charset=utf-8"
                 })
                 // 根据 blob生成 url链接
                 const objectURL = URL.createObjectURL(blob)

                 // 创建一个 a 标签Tag
                 const aTag = document.createElement('a')
                 // 设置文件的下载地址
                 aTag.href = objectURL
                 // 设置保存后的文件名称
                 aTag.download = "数组内容.txt"
                 // 给 a 标签添加点击事件
                 aTag.click()
                 // 释放一个之前已经存在的、通过调用 URL.createObjectURL() 创建的 URL 对象。
                 // 当你结束使用某个 URL 对象之后，应该通过调用这个方法来让浏览器知道不用在内存中继续保留对这个文件的引用了。
                 URL.revokeObjectURL(objectURL)

}); 

// function str2ab(val) {
//     var qaq=[]
//     if(val.length<=345)
//     qaq.push(val)//.replaceAll("　"," "))'\n','<br>'
//     else{
//       var txtnum= Math.ceil(val.length/345)
//       for(var sb=0;sb<txtnum;sb++)
//       qaq.push("'"+(sb+1)+"-"+(((sb+1)*100)/txtnum).toFixed(2)+"%"+"'")
//    //   qaq.push("'"+(sb+1)+"+-"+val.substring(sb*345,(sb+1)*345+9).replaceAll('\n','\\n').replaceAll("　"," ")+"'")
//     }
//   return qaq
// }
function str2ab2(val) {
      var txtnum= Math.ceil(val.length/345)

      val=val.replaceAll('\n','\\n').replaceAll("　"," ")

      txtnum= Math.ceil(val.length/345)
      alert(""+txtnum)
  return val
}
// function str2ab3(val) {
//     var qaq=[]
//     if(val.length<=345)
//     qaq.push(val)//.replaceAll("　"," "))'\n','<br>'
//     else{
//       var txtnum= Math.ceil(val.length/345)
//       for(var sb=0;sb<txtnum;sb++)
//      qaq.push("'"+(sb+1)+"+-"+val.substring(sb*345,(sb+1)*345+9).replaceAll('\n','\\n').replaceAll("　"," ")+"'")
//     }
//   return qaq
// }

function toUint8Arr(str) {
    const buffer = [];
    for (let i of str) {
        const _code = i.charCodeAt(0);
        if (_code < 0x80) {
            buffer.push(_code);
        } else if (_code < 0x800) {
            buffer.push(0xc0 + (_code >> 6));
            buffer.push(0x80 + (_code & 0x3f));
        } else if (_code < 0x10000) {
            buffer.push(0xe0 + (_code >> 12));
            buffer.push(0x80 + (_code >> 6 & 0x3f));
            buffer.push(0x80 + (_code & 0x3f));
        }
    }
    return Uint8Array.from(buffer);
}
        </script>
    </head>
  
</html>
